<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Pool Table</title>
    <script src="build/poolsim.js"></script>
  </head>
  <body>
    <canvas id="canvas" width="600" height="600">Upgrade your browser.</canvas>
    <br>
    Player: <label id="player"></label>
    <br>
    Ball type: <label id="ball-type"></label>

    <script>
    const game = new poolsim.Game();

    function drawTable() {
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.save();
      ctx.translate(100, 100);
      ctx.scale(400, 400);
      game.table.draw(ctx);
      ctx.restore();
    }

    function updateStats() {
      document.getElementById('player').textContent = game.turn();
      const type = game.playerType();
      const typeStr = (type === null ? 'any' : (type === poolsim.BALL_SOLID ? 'solid' : 'stripe'));
      document.getElementById('ball-type').textContent = typeStr;
    }

    let interval;
    let turnPause = 0;
    interval = setInterval(() => {
      if (--turnPause > 0) {
        return;
      }
      if (game.winner() !== null) {
        alert('winner is ' + game.winner());
        clearInterval(interval);
        return;
      }
      if (game.actionType() === null) {
        if (game.step(1 / 24)) {
          turnPause = 24;
          return;
        }
      } else {
        game.act(game.actionType().sample());
      }
      drawTable();
      updateStats();
    }, 1000 / 24);
    </script>
  </body>
</html>
